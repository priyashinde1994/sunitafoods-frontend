<!-- Premium Navbar -->
<nav class="navbar navbar-expand-lg navbar-custom">
  <div class="container-fluid">
    <a class="navbar-brand" routerLink="/">Sunita Foods</a>
    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarNav"
      aria-controls="navbarNav"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" routerLink="/">Home</a></li>
        <li class="nav-item"><a class="nav-link" routerLink="/cart-checkout">Cart</a></li>
        <li class="nav-item"><a class="nav-link" routerLink="/about">About</a></li>

        <!-- Show Login/Register if not logged in -->
        <li class="nav-item" *ngIf="!auth.isLoggedIn()">
          <a class="nav-link" routerLink="/login">Login</a>
        </li>
        <li class="nav-item" *ngIf="!auth.isLoggedIn()">
          <a class="nav-link" routerLink="/register">Register</a>
        </li>

        <!-- Show user + Logout if logged in -->
        <li class="nav-item dropdown" *ngIf="auth.isLoggedIn()">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
            {{ auth.getUser()?.name || 'User' }}
          </a>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" routerLink="/profile">Profile</a></li>
            <li><a class="dropdown-item" (click)="logout()">Logout</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- Profile Section -->
<div class="profile-container" *ngIf="user$ | async as user">
  <div class="card">
    <h2 class="profile-title">ğŸ‘¤ My Profile</h2>

    <!-- User Info -->
    <div class="profile-info">
      <p><strong>Full Name:</strong> {{ user.name }}</p>
      <p><strong>Email:</strong> {{ user.email }}</p>
      <p><strong>Mobile:</strong> {{ user.phone }}</p>
    </div>

    <!-- Saved Addresses -->
    <h3>ğŸ  Saved Addresses</h3>
    <div *ngIf="addresses$ | async as addresses">
      <div
        *ngFor="let addr of addresses"
        class="address-card mb-3 p-3 border rounded"
        [class.border-success]="addr.isDefault"
        [class.bg-light]="addr.isDefault"
      >
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <p class="mb-1">
              <strong>{{ addr.fullName }}</strong> - {{ addr.phone }}
            </p>
            <p class="mb-1">{{ addr.addressLine1 }} {{ addr.addressLine2 }}</p>
            <p class="mb-1">{{ addr.city }}, {{ addr.state }} {{ addr.zipcode }}</p>
            <p class="mb-1">{{ addr.country }}</p>

            <!-- Default Badge -->
            <span *ngIf="addr.isDefault" class="badge bg-success">âœ… Default Address</span>
          </div>

          <div class="text-end">
            <button
              (click)="setDefaultAddress(addr)"
              class="btn btn-primary me-2"
              [disabled]="addr.isDefault"
            >
              Set Default
            </button>
            <button (click)="deleteAddress(addr.id)" class="btn btn-danger">Delete</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Add New Address Form -->
    <h4>Add New Address</h4>
    <form [formGroup]="addressForm" (ngSubmit)="addAddress()" class="address-form">
      <input formControlName="fullName" placeholder="Full Name" class="form-control mb-2" />
      <input
        formControlName="phone"
        placeholder="Phone"
        class="form-control mb-2"
        maxlength="10"
        inputmode="numeric"
        (input)="addressForm.get('phone')?.setValue(addressForm.get('phone')?.value.replace(/\D/g,''))"
      />

      <!-- Error message -->
      <div
        class="text-danger"
        *ngIf="addressForm.get('phone')?.invalid && addressForm.get('phone')?.touched"
      >
        Phone must be 10 digits, starting with 6â€“9.
      </div>

      <input
        formControlName="addressLine1"
        placeholder="Address Line 1"
        class="form-control mb-2"
      />
      <input
        formControlName="addressLine2"
        placeholder="Address Line 2"
        class="form-control mb-2"
      />

      <!-- State Dropdown -->
      <select formControlName="state" class="form-control mb-2" (change)="onStateChange($event)">
        <option value="">-- Select State --</option>
        <option *ngFor="let st of states" [value]="st">{{ st }}</option>
      </select>

      <!-- City Dropdown -->
      <select formControlName="city" class="form-control mb-2" (change)="onCityChange($event)">
        <option value="">-- Select City --</option>
        <option *ngFor="let ct of cities" [value]="ct">{{ ct }}</option>
      </select>

      <!-- Hometown Dropdown -->
      <select
        formControlName="hometown"
        class="form-control mb-2"
        (change)="onHometownChange($event)"
      >
        <option value="">-- Select Hometown --</option>
        <option *ngFor="let ht of hometowns" [value]="ht">{{ ht }}</option>
      </select>

      <!-- Auto-filled ZIP -->
      <input formControlName="zipcode" placeholder="ZIP Code" class="form-control mb-2" readonly />

      <!-- Static Country -->
      <input formControlName="country" class="form-control mb-2" readonly />

      <button type="submit" class="btn btn-success">Add Address</button>
    </form>

    <!-- Actions -->
    <div class="actions mt-3">
      <a routerLink="/my-orders" class="btn btn-primary me-2">ğŸ“¦ View My Orders</a>
      <a routerLink="/cart-checkout" class="btn btn-secondary">ğŸ›’ View Cart</a>
    </div>
  </div>
</div>
